# Установка и запуск

По идее должно хватить:
1. `git pull https://github.com/KrasilnikovKB/TestJob.git`
2. `docker compose up -d`
3. в браузере открыть http://localhost:8000/

Естественно это не контейнер для прода, а лишь бы взлетело локально.

## Фронт
 - отсутствует как таковой. Просто статическая страничка с формой
 - если бы от меня требовался фронт, то я пожалуй попробовал бы вспомнить [alpine.js](https://alpinejs.dev/start-here)

## Бэк

### Сделано:
 - Использую первый попавшийся в гугле [микрофреймворк на пхп](https://www.google.com/search?q=php+microframework), исключительно ради готового роутера, классов request + response. Дополнительно поставил [библиотеку](https://github.com/rakit/validation) для валидации запросов
 - [контроллер](/src/Controller.php) с валидацией входящих параметров
 - [сервис](/src/Service.php) (по идее тут бизнес-логика)
 - [репозиторий](/src/Repository.php) - запросы к БД с частичным кешированием из редиса, на минималках
 - отдельный класс для выполнения [АПИ-запросов к сервису АТОЛа](/blob/main/src/atol/Atol.php) (токен кэшируется в редисе, что бы не было х2 запросов, и драки за один токен между несколькими инстансами приложения)

### Что следовало бы сделать:
 - контейнер, что бы зависимости создавать не вручную и только по необходимости
 - если бы прям от начала до конца протокол АТОЛА делать, то реализовать все структуры описанные в протокле через ДТО или Модели, и гонять между классами не какие то массивы а вполне себе конкретные объекты
 - вообще класс atol, надо бы было как реализацию интерфейса для всех ОФД, что бы потом уже была возможность добавлять другие (орандждату, яндекс, сбис и т.д. ... ну и фэйковый ОФД-сервис, что бы прогонять тесты)
 - контроль ошибок сейчас на минималках (та же запись в БД, или инициализация объектов на старте приложения сейчас держатся на вере, что ничего не сломается)
 - получше проработать типы исключений, но это бы делалось паралельно со схемой опен-апи (там и появляется понимание, какие типы ошибок, как надо вернуть фронту)
 - сваггер-схему апи для нормального взаимодействия бэков и фронтов (это ведь разные люди? и разные проекты?)
 - в редисе список использованных email, наверное, хранить не в строках, а в списках или множествах (но что то я с наскоку не увидел можно ли сделать ограничение по количеству элементов или установить TTL, поэтом оставил хранение в строках)
 - по ТЗ вообще непонятна задача.... как то оторвана от реальности. Из практики: обычно принимается запрос от пользователя на регистрацию чека, валидируется, если всё ОК, то пользователю или говорим, что запрос принят (если прям интерактив нужен, то можно покрутить каким то прелоадером и по сокетам уже отдать ему результат, полученный от ОФД по callback_url), далее запрос сохраняется в БД - в очередь на отправку в ОФД. Дальше уж наверное через кролика отдать воркеру на обработку (честно скажу - с кроликом не работал (сейчас почитал - крутая штука, вместо десятка самописных велосипедов)... я очередь разбирал или через кроны, или демон ([можно на том же пхп](https://github.com/walkor/workerman)... именно так я на прошлой работе в орандждату чеки отправлял))
 - класс логирования (тот же Monolog), что бы логи выводить в json-формате пригодные для скармливания тому же грейлогу или ёлке
 - подключить sentry для контроля не отловленных ошибок
 - если бы речь о проде, то попробовать сделать сбор метрик через [statsd](https://github.com/Slickdeals/statsd-php) -> прометей + графана + алертинг
 - юнит-тесты... писать их противненько, но это долгоиграющие инвестиции )
 - пайплайны сборки и деплоя
 - отдельный init-контейнер с выполнением миграций к бд, инициализацией очередей, прогревом кешей в редисе


# ИТОГО
**в общем, звучало как _"тестовое задание на день работы"_, поэтому бросил дальнейшую работу "в стол", что есть - то есть :)**

Наверное, и этого достаточно, что бы сделать какие-то выводы по мне ?

---
Времени ушло порядочно :(

- пришлось и повозиться с докером
- и почитать и про редис 
- и почитать про кролика (хоть и не использую его в итоге)
- первый попавшийся фреймворк Slim - впервые вижу его...
- а сначала и вообще делал на фреймворке [comet](https://github.com/gotzmann/comet) - штука прикольная, но далека от классической идеологии ПХП, это уже демонов писать, а не скрипты
